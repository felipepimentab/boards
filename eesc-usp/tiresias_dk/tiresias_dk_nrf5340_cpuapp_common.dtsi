/*
 * Copyright (c) 2020-2022 Nordic Semiconductor ASA
 *
 * SPDX-License-Identifier: Apache-2.0
 */
#include "tiresias_dk_nrf5340_cpuapp_common-pinctrl.dtsi"
#include <zephyr/dt-bindings/sensor/ina230.h>

/ {
	chosen {
		zephyr,console = &uart0;
		zephyr,shell-uart = &uart0;
		zephyr,uart-mcumgr = &uart0;
		zephyr,bt-mon-uart = &uart0;
		zephyr,bt-c2h-uart = &uart0;
		zephyr,bt-hci = &bt_hci_ipc0;
		watchdog0 = &wdt0;
	};

	gpio_fwd: nrf-gpio-forwarder {
		compatible = "nordic,nrf-gpio-forwarder";
		status = "okay";
		uart {
			gpios = <&gpio1 9 0>, <&gpio1 8 0>, <&gpio1 11 0>, <&gpio1 10 0>;
		};
	};

	pmic {
		compatible = "nordic,npm1100";
		nordic,iset-gpios = <&gpio0 23 GPIO_ACTIVE_HIGH>;
	};

	board_id: board_id {
		compatible = "voltage-divider";
		io-channels = <&adc 0>;
		output-ohms = <20000>;
		full-ohms = <47000>;
		power-gpios = <&gpio0 24 GPIO_ACTIVE_HIGH>;
	};

  bat_mon: bat_mon {
    compatible = "voltage-divider";
    io-channels = <&adc 1>;
    output-ohms = <20000>;
    full-ohms = <47000>;
    power-gpios = <&gpio0 25 GPIO_ACTIVE_HIGH>;
    label = "BAT_MON_EN";
  };

  adau_ctrl {
    compatible = "gpio-leds";
    mp3: mp3 {
      gpios = <&gpio0 7 GPIO_ACTIVE_HIGH>;
      label = "MP3";
    };
    mp4: mp4 {
      gpios = <&gpio0 6 GPIO_ACTIVE_HIGH>;
      label = "MP4";
    };
    mp6: mp6 {
      gpios = <&gpio0 4 GPIO_ACTIVE_HIGH>;
      label = "MP6";
    };
    mp5: mp5 {
      gpios = <&gpio0 5 GPIO_ACTIVE_HIGH>;
      label = "MP5";
    };
  };

  adau_misc {
    compatible = "gpio-leds";
    pd: pd {
      gpios = <&gpio1 0 GPIO_ACTIVE_HIGH>;
      label = "!PD";
    };
    ext_clk: ext_clk {
      gpios = <&gpio1 1 GPIO_ACTIVE_HIGH>;
      label = "EXT_CLK";
    };
  };
};

&vregmain {
	regulator-initial-mode = <NRF5X_REG_MODE_DCDC>;
};

&vregradio {
	regulator-initial-mode = <NRF5X_REG_MODE_DCDC>;
};

&vregh {
	status = "okay";
};

&lfxo {
	load-capacitors = "internal";
	load-capacitance-picofarad = <7>;
};

&adc {
	status = "okay";
	#address-cells = <1>;
	#size-cells = <0>;

	channel@0 {
		reg = <0>;
		zephyr,gain = "ADC_GAIN_1_4";
		zephyr,reference = "ADC_REF_VDD_1_4";
		zephyr,acquisition-time = <ADC_ACQ_TIME(ADC_ACQ_TIME_MICROSECONDS, 40)>;
		zephyr,input-positive = <NRF_SAADC_AIN6>;
		zephyr,resolution = <12>;
		zephyr,oversampling = <8>;
	};

	/* BAT_MON on P0.28 (AIN4) */
	channel@1 {
		reg = <1>;
		zephyr,gain = "ADC_GAIN_1_4";
		zephyr,reference = "ADC_REF_VDD_1_4";
		zephyr,acquisition-time = <ADC_ACQ_TIME(ADC_ACQ_TIME_MICROSECONDS, 40)>;
		zephyr,input-positive = <NRF_SAADC_AIN4>;
		zephyr,resolution = <12>;
		zephyr,oversampling = <8>;
	};
};

&gpiote {
	status = "okay";
};

&gpio0 {
	status = "okay";

	codec-interface {
		gpio-hog;
		gpios = <21 GPIO_ACTIVE_HIGH>;
		/* low output to select on-board codec control */
		output-low;
	};
};

&gpio1 {
	status = "okay";
};

&i2s0 {
	compatible = "nordic,nrf-i2s";
	status = "okay";
	pinctrl-0 = <&i2s0_default>;
	pinctrl-1 = <&i2s0_sleep>;
	pinctrl-names = "default", "sleep";
};

&uart0 {
	status = "okay";
	current-speed = <115200>;
	pinctrl-0 = <&uart0_default>;
	pinctrl-1 = <&uart0_sleep>;
	pinctrl-names = "default", "sleep";
};

&i2c1 {
  status = "okay";
  compatible = "nordic,nrf-twim";
  label = "I2C_1";
  pinctrl-0 = <&i2c1_default>;
  pinctrl-1 = <&i2c1_sleep>;
  pinctrl-names = "default", "sleep";
  clock-frequency = <I2C_BITRATE_STANDARD>;
  zephyr,concat-buf-size = <4092>;
  zephyr,flash-buf-max-size = <4092>;

  adau_1787: adau_1787@28 {
    compatible = "adi,adau1787", "i2c-device";
    status = "okay";
    reg = <0x28>;
    label = "adau1787";
  };

  bmi270: bmi270@68 {
    compatible = "bosch,bmi270";
    status = "okay";
    reg = <0x68>;
    label = "bmi270";
    irq-gpios = <&gpio0 2 GPIO_ACTIVE_HIGH>, <&gpio0 3 GPIO_ACTIVE_HIGH>;
  };
};

zephyr_udc0: &usbd {
	compatible = "nordic,nrf-usbd";
	status = "okay";

	hs_0: hs_0 {
		compatible = "usb-audio-hs";
		mic-feature-mute;
		mic-channel-l;
		mic-channel-r;

		hp-feature-mute;
		hp-channel-l;
		hp-channel-r;
	};
};

&qspi {
  status = "okay";
  pinctrl-0 = <&qspi_default>;
  pinctrl-1 = <&qspi_sleep>;
  pinctrl-names = "default", "sleep";

  ext_flash: flash@0 {
    compatible = "nordic,qspi-nor";
    reg = <0>;
    label = "MX25R16";
    sck-frequency = <16000000>;
    size = <0x200000>; // 2 MiB = 16 Mbit
    readoc = "read4io";
    writeoc = "pp4io";
    quad-enable-requirements = "NONE";
    jedec-id = [c2 28 15];
  };
};

/* Include default memory partition configuration file */
#include <common/nordic/nrf5340_cpuapp_partition.dtsi>
#include "tiresias_dk_nrf5340_shared.dtsi"
